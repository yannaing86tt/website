{% extends "panel/base.html" %}

{% block title %}{% if user_obj %}Edit User{% else %}Add User{% endif %}{% endblock %}

{% block content %}
<div class="content-header">
  <h1 class="content-title">{% if user_obj %}Edit User{% else %}Add New User{% endif %}</h1>
  <p class="content-subtitle">{% if user_obj %}Update user details and permissions{% else %}Create a new admin user{% endif %}</p>
</div>

{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

<div class="content-body">
  <form method="post" style="max-width: 600px;">
    {% csrf_token %}
    
    <div class="form-group">
      <label for="username">Username *</label>
      <input 
        type="text" 
        id="username" 
        name="username" 
        value="{{ user_obj.username|default:'' }}"
        required
        {% if user_obj %}readonly{% endif %}
      >
      {% if user_obj %}
        <small style="color: var(--text-muted); font-size: 12px; margin-top: 4px; display: block;">
          Username cannot be changed
        </small>
      {% endif %}
    </div>
    
    <div class="form-group">
      <label for="email">Email</label>
      <input 
        type="email" 
        id="email" 
        name="email" 
        value="{{ user_obj.email|default:'' }}"
        placeholder="user@example.com"
      >
    </div>
    
    {% if not user_obj %}
    <div class="form-group">
      <label for="password">Password *</label>
      <input 
        type="password" 
        id="password" 
        name="password" 
        required
        placeholder="Enter a secure password"
      >
    </div>
    
    <div class="form-group">
      <label for="password2">Confirm Password *</label>
      <input 
        type="password" 
        id="password2" 
        name="password2" 
        required
        placeholder="Re-enter password"
      >
    </div>
    {% endif %}
    
    <div class="form-group">
      <label for="role">Role *</label>
      <select id="role" name="role" style="width: 100%;">
        <option value="staff" {% if user_obj and not user_obj.is_superuser and not user_obj.groups.filter(name='Editor').exists %}selected{% endif %}>
          Staff (No special permissions)
        </option>
        <option value="editor" {% if user_obj and user_obj.groups.filter(name='Editor').exists %}selected{% endif %}>
          Editor (Can create posts, cannot delete)
        </option>
        <option value="superadmin" {% if user_obj and user_obj.is_superuser %}selected{% endif %}>
          Superadmin (Full access)
        </option>
      </select>
      <small style="color: var(--text-muted); font-size: 12px; margin-top: 4px; display: block;">
        Choose the appropriate role for this user
      </small>
    </div>
    
    <div class="form-group">
      <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
        <input 
          type="checkbox" 
          name="is_active" 
          {% if not user_obj or user_obj.is_active %}checked{% endif %}
          style="width: auto;"
        >
        <span>Active user</span>
      </label>
      <small style="color: var(--text-muted); font-size: 12px; margin-top: 4px; display: block;">
        Inactive users cannot log in
      </small>
    </div>
    
    <div style="display: flex; gap: 12px; margin-top: 32px;">
      <button type="submit" class="btn btn-primary">
        {% if user_obj %}Update User{% else %}Create User{% endif %}
      </button>
      <a href="/panel/users/" class="btn btn-secondary">
        Cancel
      </a>
    </div>
  </form>
</div>
{% endblock %}
